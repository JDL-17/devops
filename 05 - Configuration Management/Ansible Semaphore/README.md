# Ansible-Semaphore
Web UI for Ansible: 
https://www.youtube.com/watch?v=NyOSoLn5T5U

## Installing

### Docker

Configuring `Ansible-Semaphore` env file
```bash
cp sample.env .env
```
```ini
SEMAPHORE_DB_USER=semaphore
SEMAPHORE_DB_PASS=semaphore
SEMAPHORE_DB_HOST=postgres # for postgres, change to: postgres
SEMAPHORE_DB_PORT=5432 # change to 5432 for postgres
SEMAPHORE_DB_DIALECT=postgres
SEMAPHORE_DB=semaphore
SEMAPHORE_PLAYBOOK_PATH=/tmp/semaphore/
SEMAPHORE_ADMIN_PASSWORD=admin
SEMAPHORE_ADMIN_NAME=admin
SEMAPHORE_ADMIN_EMAIL=admin@localhost
SEMAPHORE_ADMIN=admin
SEMAPHORE_ACCESS_KEY_ENCRYPTION=1/grJgO4zNgE5MivdMUywDhfgt1ba18/YAetlcBbt9Q= # Generated by using the following command: `head -c32 /dev/urandom | base64`
SEMAPHORE_LDAP_ACTIVATED='no' # if you wish to use ldap, set to: 'yes' 
SEMAPHORE_LDAP_HOST=dc01.local.example.com
SEMAPHORE_LDAP_PORT='636'
SEMAPHORE_LDAP_NEEDTLS='yes'
SEMAPHORE_LDAP_DN_BIND='uid=bind_user,cn=users,cn=accounts,dc=local,dc=shiftsystems,dc=net'
SEMAPHORE_LDAP_PASSWORD='ldap_bind_account_password'
SEMAPHORE_LDAP_DN_SEARCH='dc=local,dc=example,dc=com'
SEMAPHORE_LDAP_SEARCH_FILTER="(\u0026(uid=%s)(memberOf=cn=ipausers,cn=groups,cn=accounts,dc=local,dc=example,dc=com))"
ANSIBLE_HOST_KEY_CHECKING=False
```

Configuring `postgres` env file
```bash
cp sample.postgres.env .postgres.env
```
```ini
POSTGRES_USER=semaphore
POSTGRES_PASSWORD=semaphore
POSTGRES_DB=semaphore
```

Configuring a `docker-compose.yml`
```yml
services:
  
  postgres:
    restart: unless-stopped
    ports:
      - 54321:5432
    image: postgres:14
    hostname: postgres
    volumes: 
     - semaphore-postgres:/var/lib/postgresql/data
    env_file: .postgres.env
  
  semaphore:
    restart: unless-stopped
    ports:
      - 3000:3000
    image: semaphoreui/semaphore:latest
    env_file: .env
    volumes:
      - ./inventory/:/inventory:ro     
      - ./files/:/files:ro       
    depends_on:
      - postgres

volumes:
  semaphore-postgres:
```

> `inventory` and `files` must be created in case you want to map configurations files or hot inventory from the WEB UI

Run the following command to start Semaphore with configured database:
```bash
docker compose up
```

Access to localhost:3000

## Mannaging 

Before starting running ansible tasks, you must create and configure your project:

1. Access to http://localhost:3000 and enter  your credentials
2. Create a new project 
3. Go to `Key Store` add your credentials. It could be: 
   - SSH Keys: In order to configure in the next steps access to your managed hosts or your privare repo. 
   - Login with password: same as previous but with user/pass credentials.
   - None: for accesing public repos
4. Go to `Enviroment` and create some environment variables that must be accessible to the playbook. 
   > Enviroment must be created. If you dont have any, just fill it with `{}`
5. Go to `Repositories` and add your ansible playbooks repo. 
6. Go to `Inventory` and add your host inventory.
   > Here you must add mannualy the hosts you want to manage, or add it by path (If you mapped an inventory directory, the path must be `/inventory/hosts.ini`) <br>
   > You must configure the access key that will be used to conect to your managed hosts via SSH
7. Go to `Task Templates` and add a `NEW TAMPLATE`
   > Here you must configure the task based in all the previous steps. <br>
   > `Playbook Filena` must match with the path of your task in the repo.
8. Run the task
